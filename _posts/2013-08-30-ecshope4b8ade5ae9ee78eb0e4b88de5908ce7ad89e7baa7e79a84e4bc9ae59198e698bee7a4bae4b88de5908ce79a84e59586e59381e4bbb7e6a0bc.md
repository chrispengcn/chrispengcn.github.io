---
ID: 173
post_title: >
  ecshop中实现不同等级的会员显示不同的商品价格
author: chris
post_excerpt: ""
layout: post
permalink: 'http://hss5.com/2013/08/30/ecshop%e4%b8%ad%e5%ae%9e%e7%8e%b0%e4%b8%8d%e5%90%8c%e7%ad%89%e7%ba%a7%e7%9a%84%e4%bc%9a%e5%91%98%e6%98%be%e7%a4%ba%e4%b8%8d%e5%90%8c%e7%9a%84%e5%95%86%e5%93%81%e4%bb%b7%e6%a0%bc/'
published: true
post_date: 2013-08-30 16:43:08
---
<h4>&nbsp;</h4> <p>1.建三个等级会员<br>2.lib_goods.php 中 查找{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_array[$key] = array();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ｝<br>..........................<br>..........................<br>/**<br>* 获得商品的详细信息<br>*<br>* @access public<br>* @param&nbsp;&nbsp; integer&nbsp;&nbsp;&nbsp;&nbsp; $goods_id<br>* @return void<br>*/<br>if( $_SESSION[user_rank] == 0 ){<br>$user_rank=6;<br>}<br>else{<br>$user_rank = $_SESSION[user_rank] ;<br>}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //取出所有符合条件的商品数据，并将结果存入对应的推荐类型数组中<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $sql = 'SELECT g.goods_id, g.goods_name, g.goods_name_style, g.market_price, g.shop_price AS org_price, g.promote_price, g.give_integral,mp.user_rank as userrank,r.rank_name, <br>r.discount, IFNULL(mp.user_price, r.discount*g.shop_price/100) AS rank_price,' .<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "IFNULL(mp.user_price, g.shop_price * '$_SESSION[discount]') AS shop_price, ".<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "promote_start_date, promote_end_date, g.goods_brief, g.goods_thumb, g.goods_img, RAND() AS rnd " .<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'FROM ' . $GLOBALS['ecs']-&gt;table('goods') . ' AS g ' .<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "LEFT JOIN " . $GLOBALS['ecs']-&gt;table('member_price') . " AS mp ".<br>&nbsp;&nbsp;&nbsp; "ON mp.goods_id = g.goods_id AND mp.user_rank = '$user_rank' ".<br>&nbsp;&nbsp;&nbsp;&nbsp; "LEFT JOIN " . $GLOBALS['ecs']-&gt;table('user_rank') . " AS r ".<br>&nbsp;&nbsp;&nbsp;&nbsp; "ON r.rank_id = $user_rank";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_merge = array_merge($type_array['new'], $type_array['best'], $type_array['hot']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_merge = array_unique($type_merge);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $sql .= ' WHERE g.goods_id ' . db_create_in($type_merge);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $sql .= ' ORDER BY g.sort_order, g.last_update DESC';<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = $GLOBALS['db']-&gt;getAll($sql);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach ($result AS $idx =&gt; $row)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($row['promote_price'] &gt; 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $promote_price = bargain_price($row['promote_price'], $row['promote_start_date'], $row['promote_end_date']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['promote_price'] = $promote_price &gt; 0 ? price_format($promote_price) : '';<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['promote_price'] = '';<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['id']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = $row['goods_id'];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['name']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = $row['goods_name'];<br>&nbsp;&nbsp; $goods[$idx]['rank_name']&nbsp;&nbsp;&nbsp; = $row['rank_name'];<br>&nbsp;&nbsp; $goods[$idx]['discount']&nbsp;&nbsp;&nbsp; = $row['discount'];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['brief']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = $row['goods_brief'];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['brand_name']&nbsp;&nbsp; = isset($goods_data['brand'][$row['goods_id']]) ? $goods_data['brand'][$row['goods_id']] : '';<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['goods_style_name']&nbsp;&nbsp; = add_style($row['goods_name'],$row['goods_name_style']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['short_name']&nbsp;&nbsp; = $GLOBALS['_CFG']['goods_name_length'] &gt; 0 ?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sub_str($row['goods_name'], $GLOBALS['_CFG']['goods_name_length']) : $row['goods_name'];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['short_style_name']&nbsp;&nbsp; = add_style($goods[$idx]['short_name'],$row['goods_name_style']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['market_price'] = price_format($row['market_price']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['shop_price']&nbsp;&nbsp; = price_format($row['shop_price']);<br>&nbsp;&nbsp; $goods[$idx]['rank_price']&nbsp;&nbsp; = price_format($row['rank_price']);<br>&nbsp;&nbsp; $goods[$idx]['give_integral']&nbsp;&nbsp; = $row['give_integral'];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['thumb']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = get_image_path($row['goods_id'], $row['goods_thumb'], true);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['goods_img']&nbsp;&nbsp;&nbsp; = get_image_path($row['goods_id'], $row['goods_img']);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $goods[$idx]['url']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = build_uri('goods', array('gid' =&gt; $row['goods_id']), $row['goods_name']); <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (in_array($row['goods_id'], $type_array['best']))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_goods['best'][] = $goods[$idx];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (in_array($row['goods_id'], $type_array['new']))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_goods['new'][] = $goods[$idx];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (in_array($row['goods_id'], $type_array['hot']))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type_goods['hot'][] = $goods[$idx];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; return $type_goods[$type];<br>}3。在模版 文件中 （如： recommend_best.lbi）<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- {if $show_marketprice} --&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {$lang.market_price}&lt;span class="market"&gt;{$goods.market_price}&lt;/span&gt;&lt;br /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- {/if} --&gt;<br>下面添加<br>添加 <br>{$goods.rank_name}{$goods.rank_price} &lt;br&gt;<br>在没有登陆的时候显示 普通会员价，登陆之后就显示会员对应的等级和价格。</p>