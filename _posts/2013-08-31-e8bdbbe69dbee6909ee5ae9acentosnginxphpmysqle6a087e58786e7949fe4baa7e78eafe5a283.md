---
ID: 225
post_title: >
  轻松搞定CentOS+Nginx+PHP+MySQL标准生产环境
author: chris
post_excerpt: ""
layout: post
permalink: 'http://hss5.com/2013/08/31/%e8%bd%bb%e6%9d%be%e6%90%9e%e5%ae%9acentosnginxphpmysql%e6%a0%87%e5%87%86%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83/'
published: true
post_date: 2013-08-31 07:47:13
---
<p>PHP 5.3.1 <p>MySQL 5.0.89 <p>Nginx 0.8.33 或 0.7.65 （可选） <p>这个可比网上流传的什么一键安装包要好得多，强烈推荐此法安装，适合所有菜鸟和高手。我服务器上全用的源代码编译安装，也好不到哪去，还很费劲。我这个装完已经包含 php 的一些常用扩展， PDO，eaccelerator，memcache，tidy等等。 <p>CentOS 最小化安装，然后先新建一个 repo <p># vi /etc/yum.repos.d/centos.21andy.com.repo <p>放入如下内容 <p>[21Andy.com]<br>name=21Andy.com Packages for Enterprise Linux 5 - $basearch<br>baseurl=http://www.21andy.com/centos/5/$basearch/<br>enabled=1<br>gpgcheck=0<br>protect=1 <p>启用 EPEL repo <p>CentOS i386 输入如下命令 <p>rpm -ihv <a href="http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm">http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm</a> <p>CentOS x86_64 输入如下命令 <p>rpm -ihv <a href="http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-3.noarch.rpm">http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-3.noarch.rpm</a> <p>然后导入key <p>rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL <p>复制代码 <p>OK，一键安装吧 <p>yum -y install nginx mysql-server php-fpm php-cli php-pdo php-mysql php-mcrypt php-mbstring php-gd php-tidy php-xml php-xmlrpc php-pear php-pecl-memcache php-eaccelerator <p>最后 yum -y update 一下，全是最新的 <p>如果 nginx 你要用 0.7.65 最新稳定版，把 <p>yum -y install nginx <p>换成 <p>yum -y install nginx-stable <p>就可以了 <p>装完你已经可以这样玩了 <p>service mysqld start <p>service php-fpm start <p>service nginx start <p>别忘了设置开机启动 <p>chkconfig --level 345 mysqld on <p>chkconfig --level 345 php-fpm on <p>chkconfig --level 345 nginx on <p>配置文件都在 /etc 下自己找 <p>看看安装多自动 <p>&nbsp; Dependencies Resolved <p>&nbsp;&nbsp;&nbsp; ==========================================================<br>&nbsp;&nbsp;&nbsp; Package Arch Version Repository Size<br>&nbsp;&nbsp;&nbsp; ==========================================================<br>&nbsp;&nbsp;&nbsp; Installing:<br>&nbsp;&nbsp;&nbsp; mysql x86_64 5.0.89-1.el5 21Andy.com 3.5 M<br>&nbsp;&nbsp;&nbsp; mysql-server x86_64 5.0.89-1.el5 21Andy.com 10 M<br>&nbsp;&nbsp;&nbsp; nginx x86_64 0.8.33-3.el5 21Andy.com 422 k<br>&nbsp;&nbsp;&nbsp; php-cli x86_64 5.3.1-2.el5 21Andy.com 2.4 M<br>&nbsp;&nbsp;&nbsp; php-eaccelerator x86_64 2:0.9.6-1.el5 21Andy.com 118 k<br>&nbsp;&nbsp;&nbsp; php-fpm x86_64 5.3.1-2.el5 21Andy.com 1.2 M<br>&nbsp;&nbsp;&nbsp; php-gd x86_64 5.3.1-2.el5 21Andy.com 110 k<br>&nbsp;&nbsp;&nbsp; php-mbstring x86_64 5.3.1-2.el5 21Andy.com 1.1 M<br>&nbsp;&nbsp;&nbsp; php-mcrypt x86_64 5.3.1-2.el5 21Andy.com 27 k<br>&nbsp;&nbsp;&nbsp; php-mysql x86_64 5.3.1-2.el5 21Andy.com 84 k<br>&nbsp;&nbsp;&nbsp; php-pdo x86_64 5.3.1-2.el5 21Andy.com 91 k<br>&nbsp;&nbsp;&nbsp; php-pear noarch 1:1.9.0-1.el5 21Andy.com 420 k<br>&nbsp;&nbsp;&nbsp; php-pecl-memcache x86_64 2.2.5-3.el5 21Andy.com 44 k<br>&nbsp;&nbsp;&nbsp; php-tidy x86_64 5.3.1-2.el5 21Andy.com 31 k<br>&nbsp;&nbsp;&nbsp; php-xml x86_64 5.3.1-2.el5 21Andy.com 115 k<br>&nbsp;&nbsp;&nbsp; php-xmlrpc x86_64 5.3.1-2.el5 21Andy.com 48 k<br>&nbsp;&nbsp;&nbsp; Installing for dependencies:<br>&nbsp;&nbsp;&nbsp; gmp x86_64 4.1.4-10.el5 base 201 k<br>&nbsp;&nbsp;&nbsp; libXaw x86_64 1.0.2-8.1 base 329 k<br>&nbsp;&nbsp;&nbsp; libXmu x86_64 1.0.2-5 base 63 k<br>&nbsp;&nbsp;&nbsp; libXpm x86_64 3.5.5-3 base 44 k<br>&nbsp;&nbsp;&nbsp; libedit x86_64 2.11-2.20080712cvs.el5 epel 80 k<br>&nbsp;&nbsp;&nbsp; libmcrypt x86_64 2.5.8-4.el5.centos extras 105 k<br>&nbsp;&nbsp;&nbsp; libtidy x86_64 0.99.0-14.20070615.el5 epel 140 k<br>&nbsp;&nbsp;&nbsp; php-common x86_64 5.3.1-2.el5 21Andy.com 554 k<br>&nbsp;&nbsp;&nbsp; sqlite2 x86_64 2.8.17-5.el5 21Andy.com 165 k<br>&nbsp;&nbsp;&nbsp; t1lib x86_64 5.1.1-7.el5 epel 208 k<br>&nbsp;&nbsp;&nbsp; Updating for dependencies:<br>&nbsp;&nbsp;&nbsp; libevent x86_64 1.4.12-1.el5 21Andy.com 129 k <p>&nbsp;&nbsp;&nbsp; Transaction Summary<br>&nbsp;&nbsp;&nbsp; ==========================================================<br>&nbsp;&nbsp;&nbsp; Install 26 Package(s)<br>&nbsp;&nbsp;&nbsp; Update 1 Package(s)<br>&nbsp;&nbsp;&nbsp; Remove 0 Package(s) <p>&nbsp; <p>&nbsp; <p>以下分别测试我本地的虚拟机和 VPS 上 Nginx + php-fpm 的性能 <p>我的本机虚拟机测试，配置为PD930 双核3.0G，2G内存，给虚拟机分配的是 1G 内存，安装的系统为 <strong>CentOS 5.4 64bit</strong> <p><strong>测试内容为</strong> <p>&lt;?php phpinfo();?&gt; <p><strong>500 </strong>并发测试，CPU使用率到了30%，系统负载在<strong>10</strong>左右，页面打开还是飞快 <blockquote> <p>[root@localhost ~]# <strong>webbench -c 500 -t 30 </strong>http://127.0.0.1/<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/<br>500 clients, running 30 sec. <p>Speed=<strong>223504 pages/min</strong>, 21806556 bytes/sec.<br>Requests: 111752 susceed, 0 failed.</p></blockquote> <p><strong>2000 </strong>并发测试，CPU使用率35%，系统负载在<strong>18</strong>左右，页面打开还是飞快 <blockquote> <p>[root@localhost ~]# <strong>webbench -c 2000 -t 30 </strong>http://127.0.0.1/<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/<br>2000 clients, running 30 sec. <p>Speed=<strong>429494 pages/min</strong>, 39004788 bytes/sec.<br>Requests: 214747 susceed, 0 failed. </p></blockquote> <p><strong>5000 </strong>并发测试，CPU使用率30%，系统负载到了<strong>35</strong>，页面打还速度还不错，看了这数据，前些天说的那个1500万PHP请求也没啥了 <blockquote> <p>[root@localhost ~]# <strong>webbench -c 5000 -t 30 </strong>http://127.0.0.1/<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/<br>5000 clients, running 30 sec. <p>Speed=<strong>788986 pages/min</strong>, 66952700 bytes/sec.<br>Requests: 394493 susceed, 0 failed.</p></blockquote> <p>还不过瘾，变态一下，10000并发 <p><strong>10000 </strong>并发，CPU使用还是不到30%，系统负载从<strong>60</strong>左右一直升到<strong>1000</strong>左右，晕死！居然还能打开！只是有点卡！负载到<strong>600</strong>多的时候居然不卡！疯了，我这还是虚拟机，webbench 还是在自己机上开的，汗，太强了 <blockquote> <p>[root@localhost ~]# <strong>webbench -c 10000 -t 30 </strong>http://127.0.0.1/<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/<br>10000 clients, running 30 sec. <p>Speed=<strong>1513718 pages/min</strong>, -17973622 bytes/sec.<br>Requests: 756859 susceed, 0 failed.</p></blockquote> <p>而我的 VPS , 2G内存，8核CPU测试，但我不是使用上面的 yum 安装，而是全用源代码编译安装的，测试结果如下： <p>500并发，CPU使用率20%，负载2左右 <blockquote> <p># <strong>webbench -c 500 -t 30 </strong>http://127.0.0.1/index.php<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/index.php<br>500 clients, running 30 sec. <p>Speed=<strong>120520 pages/min</strong>, -36244332 bytes/sec.<br>Requests: 60260 susceed, 0 failed.</p></blockquote> <p>2000并发，CPU使用率20%左右，负载2左右，没啥变化 <blockquote> <p><strong>webbench -c 2000 -t 30 </strong>http://127.0.0.1/index.php<br>Webbench - Simple Web Benchmark 1.5<br>Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software. <p>Benchmarking: GET http://127.0.0.1/index.php<br>2000 clients, running 30 sec. <p>Speed=<strong>111454 pages/min</strong>, -44285944 bytes/sec.<br>Requests: 55727 susceed, 0 failed.</p></blockquote> <p>开到3000并发也一样，但打开页面要等几秒，突然一下出来，说明我进程开少了，还有余地。 <p>现在我明白了前几天那个1500万PHP请求还能稳定访问是怎么回事了，哈哈，你只要CentOS 5.4 64bit，再按我上面的 yum 方法安装，也一样能顶住。 <p>作者：21Andy 来源：<a href="http://www.21andy.com/blog/">Andy's Blog</a> <p><strong>注：</strong>相关网站建设技巧阅读请移步到<a href="http://www.chinaz.com/web/">建站教程</a>频道。</p>